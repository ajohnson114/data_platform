# -------------------------
# Environment selection
# -------------------------
ENV ?= dev

# -------------------------
# Paths
# -------------------------
PROJECT_ROOT := $(shell pwd)
DEPLOYMENT_DIR := $(PROJECT_ROOT)/deployment
COMPOSE_FILE := $(DEPLOYMENT_DIR)/docker-compose.yaml

# -------------------------
# Docker Compose
# -------------------------
COMPOSE = docker compose -f $(COMPOSE_FILE)

# -------------------------
# Targets
# -------------------------
.PHONY: dev uat prod up down build logs ps reset help

dev:
	@$(MAKE) up ENV=dev

uat:
	@$(MAKE) up ENV=uat

prod:
	@$(MAKE) up ENV=prod

up:
	@echo "üöÄ Starting environment: $(ENV)"
	cd $(DEPLOYMENT_DIR) && ENV=$(ENV) $(COMPOSE) up --build

down:
	@echo "üõë Stopping environment: $(ENV)"
	cd $(DEPLOYMENT_DIR) && $(COMPOSE) down

build:
	@echo "üî® Building images for environment: $(ENV)"
	cd $(DEPLOYMENT_DIR) && ENV=$(ENV) $(COMPOSE) build

logs:
	cd $(DEPLOYMENT_DIR) && $(COMPOSE) logs -f

ps:
	cd $(DEPLOYMENT_DIR) && $(COMPOSE) ps

reset:
	@echo "‚ö†Ô∏è  Resetting ALL containers and volumes (destructive)"
	cd $(DEPLOYMENT_DIR) && $(COMPOSE) down -v

help:
	@echo ""
	@echo "Available commands:"
	@echo "  make dev     ‚Üí start DEV environment"
	@echo "  make uat     ‚Üí start UAT environment"
	@echo "  make prod    ‚Üí start PROD environment"
	@echo "  make down    ‚Üí stop environment"
	@echo "  make logs    ‚Üí follow logs"
	@echo "  make reset   ‚Üí remove containers and volumes"
	@echo ""
